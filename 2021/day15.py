import time
from copy import deepcopy

from utils import open_file
import numpy as np
import networkx as nx
import scipy as sp
import gurobipy as gp

dir_path = __file__.split('/')
day = int(dir_path[-1][3:-3])
year = int(dir_path[-2])

TESTSTRING = '''1163751742
1381373672
2136511328
3694931569
7463417111
1319128137
1359912421
3125421639
1293138521
2311944581
'''
STRING = '''1631196814251372911576579235812119112999813211934811373149623868144186389623722791119539949522144313
9188121321122851414231854163348238311917148974121419323871752541929227519231198852351293513134914473
4215676183741213527339331353288981132197947331219528111783619598331913296928619184942471785158367454
2251217171971152724177163921253115122983577112942474115151352465226121141697681766839691161112219324
1961611243289419266932117156684919673116135119671489326291133816113132512372721931413936141348491174
7269114374391533415635121743625566592554111117711241378517141422713695418216125897637975945511115522
1144123216126218521233215427542393912717645925127237985932114949434192124652161499471135959814578213
7796911551446529195636181229998815359954454794223223462717188113621233432281961212942721262217614613
6118139111941491415311113193921413851521589111893147725216195198122397111413115311366121921627452518
1331264861134181111918113115248139311614354942194412221294329416731932123911261981493213891761232278
2221144593111111912992873641826161238641422623111741211211518357366249184344191148548614212244354734
1211213371213148294142153457533451931866873944444194664128116531396333843195292119371231891868991141
5831917921213162781451341196354111153139261622831671142244121611561361418691252224135365111329836345
4138219222532973518122416261247534313154771248749165139128311153131378273119913353321121189987111218
7592334519894651934117182368717748728349225314316818631357329917913899122222317415829211918984472224
3529175122394833837311556412119135519619726712474999794918232711732216596127762564141171871619424237
3811393894214611963837112311561131414275467797111295142659481511391222811435211645124732872247121173
3173296527331637499232361144799131431129827112551361111233567454814221419531332911113541333811611161
4163891857422177592289991612336735419295845427316194531541411784621119116379142173129441111899274152
3517131642652188283112778215811244153141686651213636112545392472121582491151322156419586312874359791
9693566118818185918862125826722128313318227114928267863142179212514689219713693391879641397611742624
5289313922222131322321759341211211143123969192112173141216911115384347112431363387719111515937362788
4966821841158112276911292252282531318266126917161665323441152195177525617843989725926419592293915841
9427715674347511131183159319724911513177723332277514816219785137417122459113591113117371922242432141
3812391991319161863571741619317494259138312498283218186119962111111322933111156912129311211361299732
2748225685171923963542619357241266329195292813733186931124542181194142127691111743421423373615624321
9531298911291715167822699611223153831851157425916669512228121999812232324191599893781224113431448161
2891228355912333913182991329511965117911624224497739482524533516533972914514141111218425284321377721
2392681536132118225296242231917682711533193153139453227362514131852189661144942131282863945252521391
1567442934182128674727141212129359121112721119322782334881816914225919132921993219112491538371321794
1851121361571352321135771114434418715428231469375354434831131216711193961712699818226124312321791192
8568221155322245167244326491552112112164341815539523535938114762199171462119197912229874259422126928
3862153285471615891361912115213789126413194374124242361839224236133476292148411914153928149414444961
7461614147763131314729141991937121713418823199979558936646289212684938128839126168981842499124699948
8265421321298783511889124781934115116514712658827292419163265374319848122623162121741431126189413714
3615591491111213129361911857716219134853312281219569912692312373777116174347161129929917714271572417
6996142241978141451142834339345359211195945132194281949428218333124239517519991621939221729612195587
7453424594171241919916135939617918917947229726136326874465141215221112516526966767711981138874159363
8911951264661289485146575817119114851221117236412371499921316173657127246829496192218847127895111161
1123113419449955451846755127382394821613317934848159212715151895246299242523852391672211289319121519
1924196861511342262243845221421135163244657711452121724125897613437319364233319122615551448271111164
5133231123722341158315177892111565627191791992137785793928261141113113262115795828419452218914216358
6124387731112225351316112312688523814529497441968217944126564998118211519995819214119615918164534426
1752525515747712421697274222191991237551581414218172634946215191917539153568822923272748412323139411
2112812138149164595422722712157321996235689515527117418614112267271914125366621674567541835813451514
8881742352481419174936517146533211326331215444141333893455566214323112221133221661152911221612195135
1216834911351513628171992327145922222663911497229324134248271459321851128734217482592397354583193185
1291317339119291928212177981324772453591113724462116172287361912212197161657352133525999442332211435
3241429379615293177949614321731115131297249712558943263311133226641824698994911181211115187245121131
1111791929711162413141911151841443924411295154671313821798331173411268575123129423122594397973441239
1197377389494849184613145929718181471961256221988946117736829117611948593538119914121429227149218381
5919724778141943693113368181432495841334864461446156641179542144199299975134339334113161641687211229
3123532448566613219791348281111792388295617589813585624726312556993982983544216418749532871175742351
2721129162454965116371352539341912916122114721859396192192416112214431134136556386791411622568215392
3621799113274151192616819931112911147619316186119372987129612314239572118322252941181618629623232699
9813192482642252181172211559131471999285917394523134534147475497951519638431362458263239611498363158
8245535728991769628414412379188511213889882936422421248351947446189912618547748486694324323211141918
1998221314212511122326922816119413531121523933744762819792113629611871834569713577636726416223335212
2154542143191182921154392113111871292423221329599553726289311132542312952111489893241248115161567223
9138913446711888732529173545317299684127473312332811269573217313321953996892576331162211532212813221
2151168218121466631119368341318421172383118447324377166399558315399115128122789117818417261199114111
4286912117121989561772311238351374997915786221491316523117114135961662452712222135991211415912123311
6892743381397586311122737621971129191744621933753413515159315522421711221831813929121371123532474384
8251122735497191174933721352919147616119974453271591619175998133499253258915413899231185951891166151
9512331713273258623161489559275654252516919131719973713211251342434631579819179932589194739622111123
1339115831121535522715134341326763591969241321211951111419653491777532942139935416431856169184181911
8322442891391119221542435923155688223131522411294254334992646331862111958284176126126113861121286191
9177812874423371265452679291625523653984424976279214931134541123739664876887172539131641311252382191
3424121119669565423616749471611641366819942742997819411572369143113914174477341811182562133171462325
1711994313313428253367791521138393591361116122659181592329296195223531524391111563912212721711214728
1551437228341828984252161112181117116121191535261751311235151172627518271345724945232134134294212151
1122656251334226522535362472411411379179911313531197776215191314395332193417399695732937722328973111
8374378619266683323461212711912323919327471139171677141648833836911131112221236115111818114612111364
4362921324721973324932282319973622734233219221114176719141373111198221114269333313749398513849113191
1669421864982478658119633929211112129168923647927144168171145713411128916594418125154829211124963118
2949811735984154723511132731584112935392815811136711272189211318851677185871486193852872719921646713
1128752752399328511232543151549836485324972624231329896492237681265499215321411842128112371721724977
2226137319681917161531571219347264471595923321549164311417718969716955963195871224461118161394785545
4235441925421112237112832171332119221772315716945793126212523111471281229225613454946241136518328311
2936619615411418279664261341121688111121288644899384993123737471186416166457382381114393592188534153
5129929912133411894269551832522215258229221923912693112853741343169472221148214616343391822595187541
9221939111322211316111121551955416212818291329181514244391314421113241989512195432649299174611111173
1318427121511251499322211112262571511935271537519192818191218419133637821163992942716223222171936322
3351814483393439321921981116395757476153117332328984292921912163569165191285725321281423157631377119
1121714151135462121192214364317499151979417195931241591223117715112111668861911521164289191398422731
1818141213311687121119187893592411421941811359181531328135325819537132612118544245111121481811815255
4413194121141633562993511215161912854153341311278591182266346447977312132431971319162251689431471259
7811143121185311162259114151212489914141186372746512312518177425952111213141594171363416214262351514
5113517628143491126213221834835792972575931421969294189289398522929992132146178582336732941118113323
9882859948156919699392156992959495423891191358577595239228294112424199416175617341191289593564311277
5131112911239152319458266235225243429292655981113412112281443489361299162146238153227264331444211111
9128886482518115142371937326194212122198264415241946792349243111681127571967126412714925161618934571
2692917729427716331421922131398233794729447868491611691512342966151512542917291364421311219416233342
5291125973868995179656318544811113699511461511129791112281716699116231821319391859114713132397369713
1359251887142159956112811532511675311111998139353632119924367113356324976241273941662882229642431231
8194297291181931224931292129559462427245813212177618314214187642393229269815518151141722124932591124
1954581652511649212131131371211956691675612331421991137928234749695132513122331441114117129619798254
4289741424715911236217263189784412578418861111216178695219191847216835122285633211921454732479313712
9252146448218238875939619191967421281428148665211911718952111182181114219711127632131551563327591916
4519233214164141882743882142992884172832615414912312373153212281212219298923129375514264315424683991
'''

MATTSTRING = '''6851182918317729984894479998919639588287499951229786985839869531985173849166964176451789434892199898
9426994946481789516799194682986158574783332188959768397416981269349655657969713682881596193639995681
3796886996869882629998132915973989548786867985998963691489853939899277919988858417991899981198719977
9248185139261798695718986776781989149442673212774599795188279468121787972899969696979856585911949398
6299473779566125911813915682136997199718287928169899397951248974185914193847568951998753279193952849
8148286974115181837394769599139891971978995999535739268969879319467496912998861171928998691659198989
7714687982854699756819437711488839929337718978941199979812279537259321914799597345927229986211994549
1859191762117353799861888195973613898594811595799719427974391939471929349466985865972994437884976918
4789924996582993992899958998398993587621899599782949299194867972848998592987992641836281142799987191
9685322981798759174989138791499887198763891994992689973776397683579958996897917454769885649448846998
6789191274213349898637897949987691642999121985912278669499497294631978879989687988772597899489398853
8899541187936687986764981174139122881959961816983885493199685939951265698122877778946175159918528939
9952699986439995635899891246126799752986783919995866921811257898893149769954463369478989997852998513
9931425891581899192381949272615788327478998239344791911714828896265671432569198189774762995997816999
8581618784927336497999229995697796195918393877818976787576616927699141958127928917996839499769899276
8369858669942937955912211816442699772683941894396427761767385991988919159299218913385817898299451225
6599864914998939412789949497399559686786199654269695968467612419638975799587182839689615354288517687
4324765578179939112987917815945377869195454495959997291949517521699691991554697624199589939789426676
8998943917666297991734661946185856692979675845962856849349289995835969527961564598586189299197239649
2474349998759125929824899596169699498194929969789495971989693353319989798589959994997191896775279666
9397823311992847298999315312637987993188796995292697771188653763819292898624997515579394598123986699
2999757939894996746879469973889874978918536847939782945591488939679598979779585959621881889632813415
3786879979379639997228893154199891799657145859599524224228186163438961996693568885878772218711991948
6357119476898367292134799994558999999959123579815889388789382591263761963299898988162997119173898949
3499971911939119191979976923829738974229559772757989872536949884296992794587989427754799689998947769
7319799654652819812812891758592372613871898598499998998769988491199991938858991878959745381157531992
1468684961945168589969992498649126855459472584987975891483519539678195959954998486675329191189898981
5999796535732847747899499629559999481989991291183338213553138881392987929751589694818513519186515989
8969971877279154679687599942839999789819924199219972613989945683512875795799895813819961923866923969
7661989481759992932237691998849721793391539266789486647194998941891234931877977977291988998583745959
7581858699779845989999894928667969596789187889414876715696938619495386625719891737397925889147875514
7939582575855863146589222872971958448862199919156447969996578964676999478369392994395941769419715726
7664919588599891289517773626649579918479785644186954919517715835999961894979829998196877229313779119
9789939779919686938527689899911589971279559121991792659929991899988138467398979998119486996973985156
1987113452341888331415788983939823974158899719369158953599328364987895258517579998193927999942926739
4968168491589593364854994479548794995979997169937913916259791732978999679787499897141429969268954257
2846767823761639989966699865459895813415497745932517967796994194889193889361771837818891946316824181
7419953896616283991529356659738189899382679976716488911915929762836929928489468999824399891189396596
5952664821957739692491929127834595859858331611949787357394798996537991479836188819992989786289969399
1875298894394183776949938912979573795149279972888168285819492911812997337919989696879199478973129985
5919286823859696987961954614228358927895892883936514998729698954459791996176462566948885569496951888
8198742852798283579147798488755458898399659854999332299918738949995991969769999951928783929327999171
9356681651112169821995754898943385719988988159815719149883958216777218975771961399992179627838993749
9571678692979785159914996299396819198518738829982883267189677891687969791655296999744818979781699451
4499977822999798831749658798996911398289176643292258219953597143758461199752382581496999738132666972
9371498489873252352913928911896998598525174889888961698129512999956967836792982999299998439489166519
4363251581111888995249439374596968896688369878747656498596794989464319829991922479788173765678766788
2149531197725793856199668589529279498739416981259391319742193112799977998589916896736999211478384818
6652741812929838829999115348994923982959168836989491996592899776771846988482819696478299997597368387
4255583648819672318175149619998988681895817968598241979393478469969938159217895591146981673999473867
4964555898411593799435321739362869694829778589898553641198115978192569798997991195198219994889942184
9797366423999199172399876696993339889797973193816318914986338494449193894889268661898912981918519764
6687998138292477915197983479277646898952986899794571647684979994699999899996393165938937915729788661
5592847856869753492492988981958829593838157925698792597975879647828769919877219918928989182175476897
8836169198218249896917891911584981355957979918799561597841964324997517581868875971228445214896956594
9991979957665149888945894282198999633228697249992299394919785958996859286299898899826491976111378973
8848142494911863639727694919999799681883967728699792269971997284185487197797785915559194647997869275
7779759189379664999139782196969999463628798838258386616919985751671579842779877794976116569578825591
6759492767112759386944996961961199796599149618819367999459973299889229748688186194846439389594989398
9478522495191693824889482998593861917975499679652969194928977177298698588548892995776988755536949638
2879488429758945861481941459959489291581529327199976734964826343186951997124229199439599789499381947
9151999467195176382792787942529393148979898385319488971788696876995382432981616171947541994599784815
9422899387497981899948996839296997955966599469284618798836617528898869693178818849992862393169691499
3518359996372825883819125785878945215415985684479731169786945848979998959879287967949991364229895176
8976542697288796999257999123221978979998993991724599398569918592973729173898896524714495376969849988
8481395559655988985348879919869898925158361718297615446995721768592296998993331259749599564939998425
7927133913879753889999999849936931818946496994884618913769899788998278717672924799738991955934679754
7699577192967981896479118595952398684291929899991882868845894217211129138513385871694897411152572986
9188998494989968854898371859371587419885768992189979865782478339813897498999329756549179599938818766
9521753599829529719894566318278177879536194823136972369932987791734696899629168989926724859848578771
5551889549448389591869749924679853719451949199598259995443847415337788294519337599819858357135158969
7886393199129989719728316889859919596477729586982989933684389188469986916793178154679354724997978633
9574965391199192981776471866138979925783199887871999639579151787959787986988925838982865489516921196
3927797795488688693698845776289481997518191875929418751151995942699998749969776184299873985282792798
9791559589867397896887412749658968449794651489979158963681479687148898199872939926788748841584889944
5298496949878243647993929791757821993433319291398398984959365589597369893998489597335214676888568151
4992986694879568239987681454396787984419592177669488577398821999236959943476185938293298929999691399
7716811887965378991995647889458718917793892996471748846952649999915673968782252941673739691634491177
3633766499994828892892398927719985744597875769174939892535589929837872989116313627768291599829479799
9827698893491749981968648969283729997499897957413829241748399418793319183931281544259179926519539784
5485613626795937686752924885647181816699936695496996619919897887995593964748977695826489175457928711
8758592799529969633277938996489979686934788817756997869936958149649599491881641998481939955996939599
7978479148937288659399182481174686939422862837694916899697299885375945865142389214689596229652185995
1994663916588999417984895813968577357718789291129992993986921983972374167718984777911379615718952856
8167148183785798577981975199849898879952959145788668868895228269442866271144898849192759218789396797
1949781172329888625969136645967199561289712385582378579599119918929787938572139889725453891691963129
9947178739249111493182923893511575582799998593964983133969459696693991798885993271629469499146876976
9772972829559895899854497885948559996164996778838938289361994913976481619178529958211969726729538135
8927428538918682496914684982756792873489511912321968398812989748695991579992269199467887892982259779
2717218517917675896467119592763877315641496467478259218982588979597999878956958782928839691397643476
8878998995379374928252616995177747994378369327465533881284867384792667719488999812139487971565957894
9768786899684874839228498724461971799469899798671499289819194996996577858899886942968565187998919698
8925519488828789299528988579885957558829879851119599829746182181117497663958391826259185277971643493
7965716992984766446656439596378997979363981699398999919985811839662782937937946281177857997227269847
1559379255299972668933386171592188218898432689787739638786199657415499966284812959999289193169124995
7899899443897639915673626768648226882499987556984997981538887885979994649297111149491991818456198868
5979961891291523299165957518168425311537399524361897896181687192954231889954771797459935798619599423
2121416749725397396399792525295616969118499787997149336296239918996723985978919425198144297736819197
7868796992696828855862952279981147679986829877138887191789385398989849196567297576723547696881529227
8883726744936598689747689939932818828998719994999581122656889578249517477297783467688719959489399394
'''

neighbours = [(0,1),(0,-1),(1,0),(-1,0)]
def parse_input():
    # f = open_file(day,year)
    d= []
    for s in STRING.strip().split('\n'):
        e = []
        for c in s:
            e.append(int(c))
        d.append(e)
    return d


def run1(data):
    nrows = len(data)
    ncols = len(data[0])

    g = build_graph(data)
    p = nx.shortest_path(g,(0,0),(nrows-1,ncols-1),weight='weight')
    weight = sum(data[i[0]][i[1]] for i in p[1:])
    return weight

def build_graph(data):
    nrows = len(data)
    ncols = len(data[0])


    g=nx.DiGraph()

    for r in range(nrows):
        for c in range(ncols):
            for (r_p,c_p) in get_neighbours(r,c,nrows,ncols):
                g.add_edge((r,c),(r_p,c_p),weight=data[r_p][c_p])
                g.add_edge((r_p,c_p),(r,c),weight=data[r][c])

    return g


def expand(data):
    r = len(data)
    new_data = []
    for d in data:
        new_d = []
        for i in range(1,5):
            for n in d:
                m = n+i
                if m >=10:
                    m-=9
                new_d.append(m)
        new_data.append(d + new_d)

    newnew_data=[]
    for i in range(1,5):
        for d in new_data[:r]:
            new_d = []

            for n in d:
                m = n+i
                if m >=10:
                    m-=9
                new_d.append(m)
            new_data.append(new_d)

    for d in new_data:
        print(d)

    return new_data

def run1_fun(data):
    nrows = len(data)
    ncols = len(data[0])

    model = gp.Model(env=gp.Env(params={}))
    coeffs = {(r,c):data[r][c] for r in range(nrows) for c in range(ncols)}

    variables = model.addVars([(r,c,r_p,c_p) for r in range(nrows) for c in range(ncols)for (r_p,c_p) in get_neighbours(r,c,nrows,ncols)],vtype=gp.GRB.BINARY)
    model.update()
    for r in range(nrows):
        for c in range(ncols):
            flow = 0
            if (r,c) == (0,0):
                flow =1
            elif (r,c) == (nrows-1,ncols-1):
                flow=-1
            model.addConstr(variables.sum("*","*",r,c) - variables.sum(r,c,"*","*") ==flow, name=f"flow for {(r,c)} must be {flow}")

    print("done constraints")

    obj = gp.quicksum(v * coeffs[(r,c)] for (a,b,r,c),v in variables.items())

    model.setObjective(obj,sense=gp.GRB.MINIMIZE)

    model.optimize()
    m = [[" " for i in range(ncols)] for j in range(nrows)]
    m[0][0] = "X"
    s = 0
    for k,v in variables.items():
        if v.X ==1:
            # print(k)
            m[k[2]][k[3]] = "X"
            s +=coeffs[(k[2],k[3])]
        # else:
        #     m[k[2]][k[3]] = " "
    # for d in m:
    #     print(d)
    # for d in data:
    #     print(d)
    print(s)
    return s





def run2(data):
    pass

def get_neighbours(r,c,nrows,ncols):
    neigh =[]
    for n in neighbours:
        r_p,c_p = r+n[0], c+n[1]
        if nrows >r_p >=0 and ncols> c_p >=0:
            neigh.append((r_p,c_p))

    return neigh

def get_square(r,c):
    return [(r,c),(r+1,c+1),(r,c+1),(r+1,c)]

if __name__ == "__main__":
    a = time.time()
    inputs = parse_input()
    f = run1_fun(inputs)
    # f = run1(inputs)
    # expand(inputs)
    # g = run1(expand(inputs))
    # g = run1_fun(expand(inputs))
    g=0
    print(f"Part 1: {f}")
    print(f"Part 2: {g}")
    print(f"Runtime: {round((time.time() - a)*1000,3)}ms")
